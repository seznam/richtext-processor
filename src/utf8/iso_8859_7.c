#include "../string.h"
#include "iso_8859.h"
#include "iso_8859_7.h"

static unsigned long decodeIso88597Byte(unsigned int byte);

static unsigned long EXTENDED_CHARS_CODEPOINTS[128];

string *iso88597ToUtf8(text)
string *text;
{
	return transcodeIso8859ToUtf8(text, decodeIso88597Byte);
}

static unsigned long decodeIso88597Byte(byte)
unsigned int byte;
{
	unsigned long codepoint = EXTENDED_CHARS_CODEPOINTS[byte - 0x80];
	return codepoint != 0 ? codepoint : byte;
}

/* https://en.wikipedia.org/wiki/ISO/IEC_8859-7 */
static unsigned long EXTENDED_CHARS_CODEPOINTS[] = {
	/* 0x8x */
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/* 0x9x */
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/* 0xAx */
	0, 0x2018, 0x2019, 0, 0x20ac, 0x20af, 0, 0,
	0, 0, 0x37a, 0, 0, 0, 0, 0x2015,
	/* 0xBx */
	0, 0, 0, 0, 0x384, 0x385, 0x386, 0,
	0x388, 0x389, 0x38a, 0, 0x38c, 0, 0x38e, 0x38f,
	/* 0xCx */
	0x390, 0x391, 0x392, 0x393, 0x394, 0x395, 0x396, 0x397,
	0x398, 0x399, 0x39a, 0x39b, 0x39c, 0x39d, 0x39e, 0x39f,
	/* 0xDx */
	0x3a0, 0x3a1, 0, 0x3a3, 0x3a4, 0x3a5, 0x3a6, 0x3a7,
	0x3a8, 0x3a9, 0x3aa, 0x3ab, 0x3ac, 0x3ad, 0x3ae, 0x3af,
	/* 0xEx */
	0x3b0, 0x3b1, 0x3b2, 0x3b3, 0x3b4, 0x3b5, 0x3b6, 0x3b7,
	0x3b8, 0x3b9, 0x3ba, 0x3bb, 0x3bc, 0x3bd, 0x3be, 0x3bf,
	/* 0xFx */
	0x3c0, 0x3c1, 0x3c2, 0x3c3, 0x3c4, 0x3c5, 0x3c6, 0x3c7,
	0x3c8, 0x3c9, 0x3ca, 0x3cb, 0x3cc, 0x3cd, 0x3ce, 0,
};
