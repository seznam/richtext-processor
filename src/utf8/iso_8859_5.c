#include "../string.h"
#include "iso_8859.h"
#include "iso_8859_5.h"

static unsigned long decodeIso88595Byte(unsigned int byte);

static unsigned long EXTENDED_CHARS_CODEPOINTS[128];

string *iso88595ToUtf8(text)
string *text;
{
	return transcodeIso8859ToUtf8(text, decodeIso88595Byte);
}

static unsigned long decodeIso88595Byte(byte)
unsigned int byte;
{
	unsigned long codepoint = EXTENDED_CHARS_CODEPOINTS[byte - 0x80];
	return codepoint != 0 ? codepoint : byte;
}

/* https://en.wikipedia.org/wiki/ISO/IEC_8859-5 */
static unsigned long EXTENDED_CHARS_CODEPOINTS[] = {
	/* 0x8x */
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/* 0x9x */
	0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
	/* 0xAx */
	0, 0x401, 0x402, 0x403, 0x404, 0x405, 0x406, 0x407,
	0x408, 0x409, 0x40a, 0x40b, 0x40c, 0, 0x40e, 0x40f,
	/* 0xBx */
	0x410, 0x411, 0x412, 0x413, 0x414, 0x415, 0x416, 0x417,
	0x418, 0x419, 0x41a, 0x41b, 0x41c, 0x41d, 0x41e, 0x41f,
	/* 0xCx */
	0x420, 0x421, 0x422, 0x423, 0x424, 0x425, 0x426, 0x427,
	0x428, 0x429, 0x42a, 0x42b, 0x42c, 0x42d, 0x42e, 0x42f,
	/* 0xDx */
	0x430, 0x431, 0x432, 0x433, 0x434, 0x435, 0x436, 0x437,
	0x438, 0x439, 0x43a, 0x43b, 0x43c, 0x43d, 0x43e, 0x43f,
	/* 0xEx */
	0x440, 0x441, 0x442, 0x443, 0x444, 0x445, 0x446, 0x447,
	0x448, 0x449, 0x44a, 0x44b, 0x44c, 0x44d, 0x44e, 0x44f,
	/* 0xFx */
	0x2116, 0x451, 0x452, 0x453, 0x454, 0x455, 0x456, 0x457,
	0x458, 0x459, 0x45a, 0x45b, 0x45c, 0xa7, 0x45e, 0x45f
};
